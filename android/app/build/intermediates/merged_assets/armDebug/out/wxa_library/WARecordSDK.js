!function(){var e={},{recordWrapper:t}=window;["recordWrapper"].forEach((e=>window[e]=void 0));var n=window["wrapper:recordSDK"];window["wrapper:recordSDK"]=void 0;var{console:r,wxConsole:o}=n.getRecordSDKGlobalVar();Object.defineProperty(e,"__esModule",{value:!0});var a,i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function d(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function f(e){var t=null==e?void 0:e.host;return Boolean(t&&t.shadowRoot&&t.shadowRoot===e)}function p(e){var t=e.maskInputOptions,n=e.tagName,r=e.type,o=e.value,a=e.maskInputFn,i=o||"";return(t[n.toLowerCase()]||t[r])&&(i=a?a(i):"*".repeat(i.length)),i}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(a||(a={}));var v="__rrweb_original__";function h(e){for(var t=e.length,n=5381,r=0;r<t;++r)n=(n<<5)+n+e.charCodeAt(r);return String(n)}function m(e){return e.length>200}var y,g,b=1,w=new RegExp("[^a-z0-9-_:]");function S(e){var t,n;try{for(var r=[],o=e;o;){var a=o.getAttribute("id");if("__vconsole"===a)return{selector:"__wx_unselect_vconsole__",n:-1};if(r.push({id:a||"",className:o.className,tag:o.tagName}),!o.parentElement)break;o=o.parentElement}var i="";try{for(var s=l(r),u=s.next();!u.done;u=s.next()){var c=u.value;""!==i&&(i=">"+i),i=c.tag.toLowerCase()+i}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}for(var d=0,f=document.querySelectorAll(i),p=0;p<f.length;++p)if(e===f[p]){d=p;break}return{selector:i,n:d}}catch(e){return{selector:"__wx_unselect__",n:-1}}}function k(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).map(x).join(""):null}catch(e){return null}}function x(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=k(e.styleSheet)||t}catch(e){}return t}var C=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,M=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,I=/^(data:)([^,]*),(.*)/i;function T(e,t){return(e||"").replace(C,(function(e,n,r,o,a,i){var s,u,c,d=r||a||i,f=n||o||"";if(!d)return e;if(!M.test(d))return"url(".concat(f).concat(d).concat(f,")");if(I.test(d))return"url(".concat(f).concat(d).concat(f,")");if("/"===d[0])return"url(".concat(f).concat((c=t,(c.includes("//")?c.split("/").slice(0,3).join("/"):c.split("/")[0]).split("?")[0]+d)).concat(f,")");var p=t.split("/"),v=d.split("/");p.pop();try{for(var h=l(v),m=h.next();!m.done;m=h.next()){var y=m.value;"."!==y&&(".."===y?p.pop():p.push(y))}}catch(e){s={error:e}}finally{try{m&&!m.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}return"url(".concat(f).concat(p.join("/")).concat(f,")")}))}var E=/^[^ \t\n\r\u000c]+/,_=/^[, \t\n\r\u000c]+/;function N(e,t){if(!t||""===t.trim())return t;var n=e.createElement("a");return n.href=t,n.href}function O(){var e=document.createElement("a");return e.href="",e.href}function R(e,t,n,r){return"src"===n||"href"===n&&r||"xlink:href"===n&&r&&"#"!==r[0]?N(e,r):"background"!==n||!r||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&r?function(e,t){if(""===t.trim())return t;var n=0;function r(e){var r,o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}for(var o=[];r(_),!(n>=t.length);){var a=r(E);if(","===a.slice(-1))a=N(e,a.substring(0,a.length-1)),o.push(a);else{var i="";a=N(e,a);for(var s=!1;;){var u=t.charAt(n);if(""===u){o.push((a+i).trim());break}if(s)")"===u&&(s=!1);else{if(","===u){n+=1,o.push((a+i).trim());break}"("===u&&(s=!0)}i+=u,n+=1}}}return o.join(", ")}(e,r):"style"===n&&r?T(r,O()):"object"===t&&"data"===n&&r?N(e,r):r:N(e,r)}function D(e){return!e||!!e.startsWith("exparser:")}function L(e,t,n,r){var o,a,i,s;if(e&&e.nodeType===e.ELEMENT_NODE){if("wx-open-data"===e.tagName.toLowerCase().trim())return!0;if(r){if("string"==typeof t&&e.classList.contains(t))return!1;if(e.parentNode)return void 0!==(u=null===(a=null===(o=e.parentNode)||void 0===o?void 0:o.__sn)||void 0===a?void 0:a.isMasked)?u:L(e.parentNode,t,n,r)}else{if("string"==typeof n&&e.classList.contains(n))return!0;var u;if(e.parentNode)return void 0!==(u=null===(s=null===(i=e.parentNode)||void 0===i?void 0:i.__sn)||void 0===s?void 0:s.isMasked)?u:L(e.parentNode,t,n,r)}}return!!r}function F(e,t){var n,o,i,s,u,c,d,f=t.doc,b=t.blockClass,S=t.blockSelector,x=t.inlineStylesheet,C=t.maskInputOptions,M=void 0===C?{}:C,I=t.maskTextFn,E=t.maskInputFn,_=t.dataURLOptions,N=void 0===_?{}:_,F=t.inlineImages,A=t.recordCanvas,W=t.keepIframeSrcFn,P=t.unmaskClass,j=t.maskClass,H=t.isWhitelistMaskMode,U=t.hashText,z=t.uncachedTextMap,B=t.cachedTextHashes,V=t.enableMask;if(f.__sn){var X=f.__sn.id;u=1===X?void 0:X}switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:a.Document,childNodes:[],compatMode:e.compatMode,rootId:u}:{type:a.Document,childNodes:[],rootId:u};case e.DOCUMENT_TYPE_NODE:return{type:a.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:u};case e.ELEMENT_NODE:var Y=function(e,t,n){var r;if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var o=0;o<e.classList.length;o++){var a=e.classList[o];if(t.test(a))return!0}return!(!n||!e.matches(n))||!!(null===(r=e.getAttribute("is"))||void 0===r?void 0:r.startsWith("plugin-private://"))}(e,b,S),K=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return w.test(t)?"div":t}(e),J={};try{for(var $=l(Array.from(e.attributes)),Z=$.next();!Z.done;Z=$.next()){var Q=Z.value,ee=Q.name,te=Q.value;D(ee)||(J[ee]=R(f,K,ee,te))}}catch(e){n={error:e}}finally{try{Z&&!Z.done&&(o=$.return)&&o.call($)}finally{if(n)throw n.error}}if("link"===K&&x){var ne=Array.from(f.styleSheets).find((function(t){return t.href===e.href})),re=null;if(ne&&(re=k(ne)),re){delete J.rel,delete J.href;var oe=T(re,ne.href);if(U&&oe&&m(oe)){var ae=h(oe);(null==B?void 0:B.has(ae))||null==z||z.set(ae,oe),J._cssTextHash=h(oe)}else J._cssText=oe}}if("style"===K&&e.sheet&&!(e.innerText||e.textContent||"").trim().length)if(re=k(e.sheet)){oe=T(re,O());if(U&&oe&&m(oe)){ae=h(oe);(null==B?void 0:B.has(ae))||null==z||z.set(ae,oe),J._cssTextHash=h(oe)}else J._cssText=oe}if("input"===K||"textarea"===K||"select"===K){te=e.value;"radio"!==J.type&&"checkbox"!==J.type&&"submit"!==J.type&&"button"!==J.type&&te?J.value=p({type:J.type,tagName:K,value:te,maskInputOptions:M,maskInputFn:E}):e.checked&&(J.checked=e.checked)}if("option"===K&&(e.selected&&!M.select?J.selected=!0:delete J.selected),"canvas"===K&&A)if("2d"===e.__context)(function(e){var t=e.getContext("2d");if(!t)return!0;for(var n=0;n<e.width;n+=50)for(var r=0;r<e.height;r+=50){var o=t.getImageData,a=v in o?o.__rrweb_original__:o;if(new Uint32Array(a.call(t,n,r,Math.min(50,e.width-n),Math.min(50,e.height-r)).data.buffer).some((function(e){return 0!==e})))return!1}return!0})(e)||(J.rr_dataURL=e.toDataURL(N.type,N.quality));else if(!("__context"in e)){var ie=e.toDataURL(N.type,N.quality),se=document.createElement("canvas");se.width=e.width,se.height=e.height,ie!==se.toDataURL(N.type,N.quality)&&(J.rr_dataURL=ie)}if("img"===K&&F){y||(y=f.createElement("canvas"),g=y.getContext("2d"));var ue=e,le=ue.crossOrigin;ue.crossOrigin="anonymous";var ce=function(){try{y.width=ue.naturalWidth,y.height=ue.naturalHeight,g.drawImage(ue,0,0),J.rr_dataURL=y.toDataURL(N.type,N.quality)}catch(e){r.warn("Cannot inline img src=".concat(ue.currentSrc,"! Error: ").concat(e))}le?J.crossOrigin=le:delete J.crossOrigin};ue.complete&&0!==ue.naturalWidth?ce():ue.onload=ce}"audio"!==K&&"video"!==K||(J.rr_mediaState=e.paused?"paused":"played",J.rr_mediaCurrentTime=e.currentTime),e.scrollLeft&&(J.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(J.rr_scrollTop=e.scrollTop);var de=L(e,P,j,H);if(V&&de&&G(K,J,f),Y){var fe=e.getBoundingClientRect(),pe=fe.width,ve=fe.height;J=(null===(i=e.getAttribute("is"))||void 0===i?void 0:i.startsWith("plugin-private://"))&&"inline"===window.getComputedStyle(e).display?{class:J.class,style:"display:block;\n            width:".concat(pe,"px;\n            height:").concat(ve,"px;\n            background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' height='50px' width='120px'><text x='0' y='15' fill='grey' font-size='8'>plugin: ").concat(e.tagName,'</text></svg>");\n            background-repeat: repeat;\n            background-color: #ccc;')}:{class:J.class,rr_width:"".concat(pe,"px"),rr_height:"".concat(ve,"px")}}return"iframe"!==K||W(J.src)||(e.contentDocument||(J.rr_src=J.src),delete J.src),{type:a.Element,tagName:K,attributes:J,childNodes:[],isSVG:(d=e,Boolean("svg"===d.tagName||d.ownerSVGElement)||void 0),needBlock:Y,rootId:u,isMasked:de};case e.TEXT_NODE:var he=e.parentNode&&e.parentNode.tagName,me=e.textContent,ye="STYLE"===he||void 0,ge="SCRIPT"===he||void 0;if(ye&&me){try{e.nextSibling||e.previousSibling||(null===(s=e.parentNode.sheet)||void 0===s?void 0:s.cssRules)&&(me=(c=e.parentNode.sheet).cssRules?Array.from(c.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(t){r.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(t),e)}me=T(me,O())}if(ge&&(me="SCRIPT_PLACEHOLDER"),!ye&&!ge&&e.parentNode&&me&&(me=V?q(e.parentNode,me,I):me),me&&U&&m(me)){ae=h(me);return(null==B?void 0:B.has(ae))||null==z||z.set(ae,me),{type:a.Text,textContent:ae,isStyle:ye,rootId:u,isHash:!0}}return{type:a.Text,textContent:me||"",isStyle:ye,rootId:u};case e.CDATA_SECTION_NODE:return{type:a.CDATA,textContent:"",rootId:u};case e.COMMENT_NODE:return{type:a.Comment,textContent:e.textContent||"",rootId:u};default:return!1}}function A(e){return void 0===e?"":e.toLowerCase()}var W,P,j,H,U,z,B,V="http://dldir1.qq.com/WechatWebDev/devPlatform/mask.jpeg";function G(e,t,n){var r=e.toLowerCase().trim();if("img"!==r&&"wx-image"!==r&&"video"!==r||(t.src&&(t.src=V),t.srcset&&(t.src=V,delete t.srcset)),null==t?void 0:t.style)if("string"==typeof t.style){if(t.style.includes("background-image:")){var o=n.createElement("div");o.setAttribute("style",null==t?void 0:t.style),o.style.setProperty("background-image",'url("'.concat(V,'")')),t.style=R(n,r,"style",o.getAttribute("style"))}}else"object"==typeof t.style&&t.style["background-image"]&&("string"==typeof t.style["background-image"]?t.style["background-image"]='url("'.concat(V,'")'):t.style["background-image"][0]='url("'.concat(V,'")'))}function q(e,t,n){var r;return!1===(null===(r=null==e?void 0:e.__sn)||void 0===r?void 0:r.isMasked)?t:t?n?n(t):t.replace(/[\S]/g,"*"):""}function X(e,t){var n,o,i,s,u,c,d,p=t.doc,v=t.map,h=t.blockClass,m=t.blockSelector,y=t.skipChild,g=void 0!==y&&y,w=t.inlineStylesheet,S=void 0===w||w,k=t.maskInputOptions,x=void 0===k?{}:k,C=t.maskTextFn,M=t.maskInputFn,I=t.slimDOMOptions,T=t.dataURLOptions,E=void 0===T?{}:T,_=t.inlineImages,N=void 0!==_&&_,O=t.recordCanvas,R=void 0!==O&&O,D=t.onSerialize,L=t.onIframeLoad,W=t.iframeLoadTimeout,P=void 0===W?5e3:W,j=t.keepIframeSrcFn,H=void 0===j?function(){return!1}:j,U=t.unmaskClass,z=t.maskClass,B=t.isWhitelistMaskMode,V=t.hashText,G=t.cachedTextHashes,q=t.uncachedTextMap,Y=t.enableMask,K=t.preserveWhiteSpace,J=void 0===K||K,$=F(e,{doc:p,blockClass:h,blockSelector:m,inlineStylesheet:S,maskInputOptions:x,maskTextFn:C,maskInputFn:M,dataURLOptions:E,inlineImages:N,recordCanvas:R,keepIframeSrcFn:H,unmaskClass:U,maskClass:z,isWhitelistMaskMode:B,hashText:V,cachedTextHashes:G,uncachedTextMap:q,enableMask:Y});if(!$)return r.warn(e,"not serialized"),null;d="__sn"in e?e.__sn.id:!function(e,t){if(t.comment&&e.type===a.Comment)return!0;if(e.type===a.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(A(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===A(e.attributes.name)||"icon"===A(e.attributes.rel)||"apple-touch-icon"===A(e.attributes.rel)||"shortcut icon"===A(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&A(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(A(e.attributes.property).match(/^(og|twitter|fb):/)||A(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===A(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===A(e.attributes.name)||"googlebot"===A(e.attributes.name)||"bingbot"===A(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===A(e.attributes.name)||"generator"===A(e.attributes.name)||"framework"===A(e.attributes.name)||"publisher"===A(e.attributes.name)||"progid"===A(e.attributes.name)||A(e.attributes.property).match(/^article:/)||A(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===A(e.attributes.name)||"yandex-verification"===A(e.attributes.name)||"csrf-token"===A(e.attributes.name)||"p:domain_verify"===A(e.attributes.name)||"verify-v1"===A(e.attributes.name)||"verification"===A(e.attributes.name)||"shopify-checkout-api-token"===A(e.attributes.name)))return!0}}return!1}($,I)&&(J||$.type!==a.Text||$.isStyle||$.textContent.replace(/^\s+|\s+$/gm,"").length)?b++:-2;var Z=Object.assign($,{id:d});if(e.__sn=Z,-2===d)return null;v[d]=e,D&&D(e);var Q=!g;if(Z.type===a.Element&&(Q=Q&&!Z.needBlock,e.shadowRoot&&(Z.isShadowHost=!0)),(Z.type===a.Document||Z.type===a.Element)&&Q){I.headWhitespace&&$.type===a.Element&&"head"===$.tagName&&(J=!1);var ee={doc:p,map:v,blockClass:h,blockSelector:m,skipChild:g,inlineStylesheet:S,maskInputOptions:x,maskTextFn:C,maskInputFn:M,slimDOMOptions:I,dataURLOptions:E,inlineImages:N,recordCanvas:R,preserveWhiteSpace:J,onSerialize:D,onIframeLoad:L,iframeLoadTimeout:P,keepIframeSrcFn:H,unmaskClass:U,maskClass:z,isWhitelistMaskMode:B,hashText:V,cachedTextHashes:G,uncachedTextMap:q,enableMask:Y};if(e.nodeType===e.DOCUMENT_NODE)try{for(var te=l(Array.from(e.children)),ne=te.next();!ne.done;ne=te.next()){(se=X(ne.value,ee))&&Z.childNodes.push(se)}}catch(e){n={error:e}}finally{try{ne&&!ne.done&&(o=te.return)&&o.call(te)}finally{if(n)throw n.error}}else try{for(var re=l(Array.from(e.childNodes)),oe=re.next();!oe.done;oe=re.next()){(se=X(oe.value,ee))&&Z.childNodes.push(se)}}catch(e){i={error:e}}finally{try{oe&&!oe.done&&(s=re.return)&&s.call(re)}finally{if(i)throw i.error}}if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot)try{for(var ae=l(Array.from(e.shadowRoot.childNodes)),ie=ae.next();!ie.done;ie=ae.next()){var se;(se=X(ie.value,ee))&&(se.isShadow=!0,Z.childNodes.push(se))}}catch(e){u={error:e}}finally{try{ie&&!ie.done&&(c=ae.return)&&c.call(ae)}finally{if(u)throw u.error}}}return e.parentNode&&f(e.parentNode)&&(Z.isShadow=!0),Z.type===a.Element&&"iframe"===Z.tagName&&function(e,t,n){var r=e.contentWindow;if(r){var o,a=!1;try{o=r.document.readyState}catch(e){return}if("complete"===o){var i="about:blank";r.location.href===i&&e.src!==i&&""!==e.src?e.addEventListener("load",t):setTimeout(t,0)}else{var s=setTimeout((function(){a||(t(),a=!0)}),n);e.addEventListener("load",(function(){clearTimeout(s),a=!0,t()}))}}}(e,(function(){var t=e.contentDocument;if(t&&L){var n=X(t,{doc:t,map:v,blockClass:h,blockSelector:m,skipChild:!1,inlineStylesheet:S,maskInputOptions:x,maskTextFn:C,maskInputFn:M,slimDOMOptions:I,dataURLOptions:E,inlineImages:N,recordCanvas:R,preserveWhiteSpace:J,onSerialize:D,onIframeLoad:L,iframeLoadTimeout:P,keepIframeSrcFn:H,unmaskClass:U,maskClass:z,isWhitelistMaskMode:B,hashText:V,cachedTextHashes:G,uncachedTextMap:q,enableMask:Y});n&&L(e,n)}}),P),Z}function Y(e,t,n){void 0===n&&(n=document);var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e[e.App=7]="App",e[e.Ref=8]="Ref",e[e.Dummy=9]="Dummy",e[e.Orientation=10]="Orientation",e[e.Start=11]="Start",e[e.Stop=12]="Stop"}(W||(W={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.WxInput=14]="WxInput"}(P||(P={})),function(e){e[e.Change=0]="Change",e[e.Focus=1]="Focus",e[e.Blur=2]="Blur"}(j||(j={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e[e.Tap=11]="Tap"}(H||(H={})),function(e){e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2"}(U||(U={})),function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange"}(z||(z={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(B||(B={}));var K="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",J={map:{},getId:function(){return r.error(K),-1},getNode:function(){return r.error(K),null},removeNodeFromMap:function(){r.error(K)},has:function(){return r.error(K),!1},reset:function(){r.error(K)}};function $(e,t,n){void 0===n&&(n={});var r=null,o=0;return function(a){var i=Date.now();o||!1!==n.leading||(o=i);var s=t-(i-o),u=this,l=arguments;s<=0||s>t?(r&&(clearTimeout(r),r=null),o=i,e.apply(u,l)):r||!1===n.trailing||(r=setTimeout((function(){o=!1===n.leading?0:Date.now(),r=null,e.apply(u,l)}),s))}}function Z(e,t,n,r,o){void 0===o&&(o=window);var a=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set:function(e){var t=this;setTimeout((function(){n.set.call(t,e)}),0),a&&a.set&&a.set.call(this,e)}}),function(){return Z(e,t,a||{},!0)}}function Q(e,t,n){try{if(!(t in e))return function(){};var r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,function(){e[t]=r}}catch(e){return function(){}}}function ee(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function te(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function ne(e,t){var n,r,o;if(!e)return!1;if(void 0!==(null===(n=null==e?void 0:e.__sn)||void 0===n?void 0:n.needBlock))return null===(r=null==e?void 0:e.__sn)||void 0===r?void 0:r.needBlock;if(e.nodeType===e.ELEMENT_NODE){var a=!1;return"string"==typeof t?a=e.classList.contains(t):e.classList.forEach((function(e){t.test(e)&&(a=!0)})),(null===(o=e.getAttribute("is"))||void 0===o?void 0:o.startsWith("plugin-private://"))&&(a=!0),a||ne(e.parentNode,t)}return e.nodeType,e.TEXT_NODE,ne(e.parentNode,t)}function re(e){return"__sn"in e&&-2===e.__sn.id}function oe(e,t){if(f(e))return!1;var n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||oe(e.parentNode,t))}function ae(e){return Boolean(e.changedTouches)}function ie(e){return"__sn"in e&&(e.__sn.type===a.Element&&"iframe"===e.__sn.tagName)}function se(e){return Boolean(null==e?void 0:e.shadowRoot)}function ue(e){var t,n,r=[];try{for(var o=l(e.entries()),a=o.next();!a.done;a=o.next()){var i=c(a.value,2),s=i[0],u=i[1];r.push({k:s,v:u})}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function le(e){return"__ln"in e}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(J=new Proxy(J,{get:function(e,t,n){return"map"===t&&r.error(K),Reflect.get(e,t,n)}}));var ce=function(){function e(){this.length=0,this.head=null}return e.prototype.get=function(e){if(e>=this.length)throw new Error("Position outside of list range");for(var t=this.head,n=0;n<e;n++)t=(null==t?void 0:t.next)||null;return t},e.prototype.addNode=function(e){var t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&le(e.previousSibling)){var n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&le(e.nextSibling)&&e.nextSibling.__ln.previous){n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++},e.prototype.removeNode=function(e){var t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)},e}(),de=function(e,t){return"".concat(e,"@").concat(t)};function fe(e){return"__sn"in e}var pe=function(){function e(e){var t=this;this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=function(e){e.forEach(t.processMutation),t.emit()},this.emit=function(){var e,n,r,o;if(!t.frozen&&!t.locked){for(var a=[],i=new ce,s=function(e){for(var n,r=e,o=-2;-2===o;)o=(r=null!==(n=null==r?void 0:r.nextSibling)&&void 0!==n?n:null)&&t.mirror.getId(r);return o},u=function(e){for(var n,r,o,u,l,c=e.getRootNode?null===(n=e.getRootNode())||void 0===n?void 0:n.host:null,d=c;null===(o=null===(r=null==d?void 0:d.getRootNode)||void 0===r?void 0:r.call(d))||void 0===o?void 0:o.host;)d=(null===(l=null===(u=null==d?void 0:d.getRootNode)||void 0===u?void 0:u.call(d))||void 0===l?void 0:l.host)||null;var p=!(t.doc.contains(e)||d&&t.doc.contains(d));if(e.parentNode&&!p){var v=f(e.parentNode)?t.mirror.getId(c):t.mirror.getId(e.parentNode),h=s(e);if(-1===v||-1===h)return i.addNode(e);var m=X(e,{doc:t.doc,map:t.mirror.map,blockClass:t.blockClass,blockSelector:t.blockSelector,skipChild:!0,inlineStylesheet:t.inlineStylesheet,maskInputOptions:t.maskInputOptions,maskTextFn:t.maskTextFn,maskInputFn:t.maskInputFn,slimDOMOptions:t.slimDOMOptions,recordCanvas:t.recordCanvas,unmaskClass:t.unmaskClass,maskClass:t.maskClass,isWhitelistMaskMode:t.isWhitelistMaskMode,inlineImages:t.inlineImages,hashText:t.hashText,uncachedTextMap:t.uncachedTextMap,cachedTextHashes:t.cachedTextHashes,enableMask:t.enableMask,onSerialize:function(n){ie(n)&&t.iframeManager.addIframe(n),se(e)&&t.shadowDomManager.addShadowRoot(e.shadowRoot,document),ye(n,t.wxInputCb)},onIframeLoad:function(e,t){}});m&&"__wx_unselect_vconsole__"!==m.selector&&a.push({parentId:v,nextId:h,node:m})}};t.mapRemoves.length;)t.mirror.removeNodeFromMap(t.mapRemoves.shift());try{for(var c=l(t.movedSet),d=c.next();!d.done;d=c.next()){var p=d.value;he(t.removes,p,t.mirror)&&!t.movedSet.has(p.parentNode)||u(p)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var v=l(t.addedSet),h=v.next();!h.done;h=v.next()){p=h.value;me(t.droppedSet,p)||he(t.removes,p,t.mirror)?me(t.movedSet,p)?u(p):t.droppedSet.add(p):u(p)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}for(var m=null;i.length;){var y=null;if(m){var g=t.mirror.getId(m.value.parentNode),b=s(m.value);-1!==g&&-1!==b&&(y=m)}if(!y)for(var w=i.length-1;w>=0;w--){var S=i.get(w);if(S){g=t.mirror.getId(S.value.parentNode),b=s(S.value);if(-1!==g&&-1!==b){y=S;break}}}if(!y){for(;i.head;)i.removeNode(i.head.value);break}m=y.previous,i.removeNode(y.value),u(y.value)}var k={texts:t.texts.map((function(e){return{id:t.mirror.getId(e.node),value:e.value,isHash:e.isHash||!1}})).filter((function(e){return t.mirror.has(e.id)})),attributes:t.attributes.map((function(e){return{id:t.mirror.getId(e.node),attributes:e.attributes}})).filter((function(e){return t.mirror.has(e.id)})),removes:t.removes,adds:a};(k.texts.length||k.attributes.length||k.removes.length||k.adds.length)&&(t.texts=[],t.attributes=[],t.removes=[],t.addedSet=new Set,t.movedSet=new Set,t.droppedSet=new Set,t.movedMap={},t.mutationCb(k))}},this.processMutation=function(e){var n,r,o,a,i,s;if(!re(e.target))switch(e.type){case"characterData":var u=e.target.textContent;if(!ne(e.target,t.blockClass)&&u!==e.oldValue){var c=t.enableMask?q(e.target.parentNode,u||"",t.maskTextFn):u||"";if(t.hashText&&u&&m(u)){var d=h(c);(null===(i=t.cachedTextHashes)||void 0===i?void 0:i.has(d))||null===(s=t.uncachedTextMap)||void 0===s||s.set(d,c),t.texts.push({value:d,node:e.target,isHash:!0})}else t.texts.push({value:c,node:e.target})}break;case"attributes":var v=e.target;u=e.target.getAttribute(e.attributeName);if("value"===e.attributeName&&(u=p({maskInputOptions:t.maskInputOptions,tagName:e.target.tagName,type:e.target.getAttribute("type"),value:u,maskInputFn:t.maskInputFn})),ne(e.target,t.blockClass)||u===e.oldValue)return;var y=t.attributes.find((function(t){return t.node===e.target}));if(y||(y={node:e.target,attributes:{}},t.attributes.push(y)),"style"===e.attributeName){var g=t.doc.createElement("span");e.oldValue&&g.setAttribute("style",e.oldValue),void 0!==y.attributes.style&&null!==y.attributes.style||(y.attributes.style={});var b=y.attributes.style;try{for(var w=l(Array.from(v.style)),S=w.next();!S.done;S=w.next()){var k=S.value,x=v.style.getPropertyValue(k),C=v.style.getPropertyPriority(k);x===g.style.getPropertyValue(k)&&C===g.style.getPropertyPriority(k)||(b[k]=""===C?x:[x,C])}}catch(e){n={error:e}}finally{try{S&&!S.done&&(r=w.return)&&r.call(w)}finally{if(n)throw n.error}}try{for(var M=l(Array.from(g.style)),I=M.next();!I.done;I=M.next()){k=I.value;""===v.style.getPropertyValue(k)&&(b[k]=!1)}}catch(e){o={error:e}}finally{try{I&&!I.done&&(a=M.return)&&a.call(M)}finally{if(o)throw o.error}}}else{if(D(e.attributeName))break;y.attributes[e.attributeName]=R(t.doc,e.target.tagName,e.attributeName,u)}t.enableMask&&L(v,t.unmaskClass,t.maskClass,t.isWhitelistMaskMode)&&G(v.tagName,y.attributes,t.doc);break;case"childList":e.addedNodes.forEach((function(n){return t.genAdds(n,e.target)})),e.removedNodes.forEach((function(n){var r=t.mirror.getId(n),o=f(e.target)?t.mirror.getId(e.target.host):t.mirror.getId(e.target);ne(e.target,t.blockClass)||re(n)||(t.addedSet.has(n)?(ve(t.addedSet,n),t.droppedSet.add(n)):t.addedSet.has(e.target)&&-1===r||oe(e.target,t.mirror)||(t.movedSet.has(n)&&t.movedMap[de(r,o)]?ve(t.movedSet,n):t.removes.push({parentId:o,id:r,isShadow:!!f(e.target)||void 0})),t.mapRemoves.push(n))}))}},this.genAdds=function(e,n){if(!n||!ne(n,t.blockClass)){if(fe(e)){if(re(e))return;t.movedSet.add(e);var r=null;n&&fe(n)&&(r=n.__sn.id),r&&(t.movedMap[de(e.__sn.id,r)]=!0)}else t.addedSet.add(e),t.droppedSet.delete(e);ne(e,t.blockClass)||e.childNodes.forEach((function(e){return t.genAdds(e)}))}},this.mutationCb=e.mutationCb,this.blockClass=e.blockClass,this.blockSelector=e.blockSelector,this.inlineStylesheet=e.inlineStylesheet,this.maskInputOptions=e.maskInputOptions,this.maskTextFn=e.maskTextFn,this.maskInputFn=e.maskInputFn,this.recordCanvas=e.recordCanvas,this.inlineImages=e.inlineImages,this.slimDOMOptions=e.slimDOMOptions,this.doc=e.doc,this.mirror=e.mirror,this.iframeManager=e.iframeManager,this.shadowDomManager=e.shadowDomManager,this.canvasManager=e.canvasManager,this.unmaskClass=e.unmaskClass,this.maskClass=e.maskClass,this.isWhitelistMaskMode=e.isWhitelistMaskMode,this.hashText=e.hashText,this.cachedTextHashes=e.cachedTextHashes,this.uncachedTextMap=e.uncachedTextMap,this.enableMask=e.enableMask,this.wxInputCb=e.wxInputCb}return e.prototype.freeze=function(){this.frozen=!0,this.canvasManager.freeze()},e.prototype.unfreeze=function(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()},e.prototype.isFrozen=function(){return this.frozen},e.prototype.lock=function(){this.locked=!0,this.canvasManager.lock()},e.prototype.unlock=function(){this.locked=!1,this.canvasManager.unlock(),this.emit()},e.prototype.reset=function(){this.shadowDomManager.reset(),this.canvasManager.reset()},e}();function ve(e,t){e.delete(t),t.childNodes.forEach((function(t){return ve(e,t)}))}function he(e,t,n){var r=t.parentNode;if(!r)return!1;var o=n.getId(r);return!!e.some((function(e){return e.id===o}))||he(e,r,n)}function me(e,t){var n=t.parentNode;return!!n&&(!!e.has(n)||me(e,n))}function ye(e,t){if(e.nodeType===document.ELEMENT_NODE&&"wx-input"===e.tagName.toLowerCase()){var n=e.__wxElement,o=S(e),a=o.selector,i=o.n;try{n&&(exparser.addListenerToElement(n,"change",(function(n){t({selector:a,n:i,text:n.detail.value,type:j.Change,id:e.__sn.id})})),exparser.addListenerToElement(n,"focus",(function(n){t({selector:a,n:i,text:n.detail.value,type:j.Focus,id:e.__sn.id})})),exparser.addListenerToElement(n,"blur",(function(n){t({selector:a,n:i,text:n.detail.value,type:j.Blur,id:e.__sn.id})})))}catch(e){r.log("addWxInputListener",e)}}}var ge=[],be="undefined"!=typeof CSSGroupingRule,we="undefined"!=typeof CSSMediaRule,Se="undefined"!=typeof CSSSupportsRule,ke="undefined"!=typeof CSSConditionRule;function xe(e){try{if("composedPath"in e){var t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function Ce(e,t){var n,r,o,a,i=new pe(e);ge.push(i);var s=window.MutationObserver||window.__rrMutationObserver,u=null===(r=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===r?void 0:r.call(n,"MutationObserver");u&&window[u]&&(s=window[u]);var l=new s(i.processMutations.bind(i));return(null===(o=null===window||void 0===window?void 0:window.$wujie)||void 0===o?void 0:o.shadowRoot)?l.observe(null===(a=null===window||void 0===window?void 0:window.$wujie)||void 0===a?void 0:a.shadowRoot,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}):l.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),l}function Me(e){var t=e.mouseInteractionCb,n=e.doc,r=e.mirror,o=e.blockClass,a=e.sampling;if(!1===a.mouseInteraction)return function(){};var i=!0===a.mouseInteraction||void 0===a.mouseInteraction?{}:a.mouseInteraction,s=[];return Object.keys(H).filter((function(e){return Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e]})).forEach((function(e){var a=e.toLowerCase(),i=function(e){return function(n){var a=xe(n);if(!ne(a,o)){var i=ae(n),s=i?n.changedTouches[0]:n;if(s){for(var u=r.getId(a),l=s,c=l.clientX,d=l.clientY,f=l.pageX,p=l.pageY,v=l.offsetX,h=l.offsetY,m=a,y=m.clientHeight,g=m.clientWidth,b=[],w=a;w;){var k=w.getAttribute("id");if(b.push({id:k||"",className:w.className,tag:w.tagName}),!w.parentElement)break;w=w.parentElement}var x=S(a),C=x.n,M=x.selector;t({type:H[e],id:u,x:c,y:d,pageX:f,pageY:p,relativeX:i?void 0:v/g,relativeY:i?void 0:h/y,idTrusted:i?n.isTrusted:void 0,identifier:i?s.identifier:void 0,selector:M,n:C})}}}}(e);s.push(Y(a,i,n))})),function(){s.forEach((function(e){return e()}))}}function Ie(e){var t=e.scrollCb,n=e.doc,r=e.mirror,o=e.blockClass;return Y("scroll",$((function(e){var a=xe(e);if(a&&!ne(a,o)){var i=r.getId(a);if(a===n){var s=n.scrollingElement||n.documentElement;t({id:i,x:s.scrollLeft,y:s.scrollTop})}else t({id:i,x:a.scrollLeft,y:a.scrollTop})}}),e.sampling.scroll||100),n)}function Te(e,t){var n=i({},e);return t||delete n.userTriggered,n}var Ee=["INPUT","TEXTAREA","SELECT"],_e=new WeakMap;function Ne(e){return function(e,t){if(be&&e.parentRule instanceof CSSGroupingRule||we&&e.parentRule instanceof CSSMediaRule||Se&&e.parentRule instanceof CSSSupportsRule||ke&&e.parentRule instanceof CSSConditionRule){var n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else{n=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(n)}return t}(e,[])}function Oe(e,t){var n,r;void 0===t&&(t={});var o=e.doc.defaultView;if(!o)return function(){};!function(e,t){var n=e.mutationCb,r=e.mousemoveCb,o=e.mouseInteractionCb,a=e.scrollCb,i=e.viewportResizeCb,s=e.inputCb,u=e.mediaInteractionCb,l=e.styleSheetRuleCb,f=e.styleDeclarationCb,p=e.canvasMutationCb,v=e.fontCb;e.mutationCb=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.mutation&&t.mutation.apply(t,d([],c(e),!1)),n.apply(void 0,d([],c(e),!1))},e.mousemoveCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mousemove&&t.mousemove.apply(t,d([],c(e),!1)),r.apply(void 0,d([],c(e),!1))},e.mouseInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mouseInteraction&&t.mouseInteraction.apply(t,d([],c(e),!1)),o.apply(void 0,d([],c(e),!1))},e.scrollCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.scroll&&t.scroll.apply(t,d([],c(e),!1)),a.apply(void 0,d([],c(e),!1))},e.viewportResizeCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.viewportResize&&t.viewportResize.apply(t,d([],c(e),!1)),i.apply(void 0,d([],c(e),!1))},e.inputCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.input&&t.input.apply(t,d([],c(e),!1)),s.apply(void 0,d([],c(e),!1))},e.mediaInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mediaInteaction&&t.mediaInteaction.apply(t,d([],c(e),!1)),u.apply(void 0,d([],c(e),!1))},e.styleSheetRuleCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleSheetRule&&t.styleSheetRule.apply(t,d([],c(e),!1)),l.apply(void 0,d([],c(e),!1))},e.styleDeclarationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleDeclaration&&t.styleDeclaration.apply(t,d([],c(e),!1)),f.apply(void 0,d([],c(e),!1))},e.canvasMutationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.canvasMutation&&t.canvasMutation.apply(t,d([],c(e),!1)),p.apply(void 0,d([],c(e),!1))},e.fontCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.font&&t.font.apply(t,d([],c(e),!1)),v.apply(void 0,d([],c(e),!1))}}(e,t);var a=Ce(e,e.doc),s=function(e){var t=e.mousemoveCb,n=e.sampling,r=e.doc,o=e.mirror;if(!1===n.mousemove)return function(){};var a,i="number"==typeof n.mousemove?n.mousemove:50,s="number"==typeof n.mousemoveCallback?n.mousemoveCallback:500,u=[],l=$((function(e){var n=Date.now()-a;t(u.map((function(e){return e.timeOffset-=n,e})),e),u=[],a=null}),s),c=$((function(e){var t=xe(e),n=ae(e)?e.changedTouches[0]:e,r=n.clientX,i=n.clientY;a||(a=Date.now()),u.push({x:r,y:i,identifier:ae(e)?n.identifier:void 0,isTrusted:ae(e)?e.isTrusted:void 0,id:o.getId(t),timeOffset:Date.now()-a}),l("undefined"!=typeof DragEvent&&e instanceof DragEvent?P.Drag:e instanceof MouseEvent?P.MouseMove:P.TouchMove)}),i,{trailing:!1}),d=[Y("mousemove",c,r),Y("touchmove",c,r),Y("drag",c,r)];return function(){d.forEach((function(e){return e()}))}}(e),u=Me(e),f=Ie(e),v=function(e){var t=e.viewportResizeCb,n=-1,r=-1;return Y("resize",$((function(){var e=ee(),o=te();n===e&&r===o||(t({width:Number(o),height:Number(e)}),n=e,r=o)}),200),window)}(e),h=function(e){var t=e.inputCb,n=e.doc,r=e.mirror,o=e.blockClass,a=e.ignoreClass,s=e.maskInputOptions,u=e.maskInputFn,l=e.sampling,f=e.userTriggeredOnInput;function v(e){var t=xe(e),r=e.isTrusted;if(t&&"OPTION"===t.tagName&&(t=t.parentElement),t&&t.tagName&&Ee.includes(t.tagName)&&!ne(t,o)){var i=t.type;if(!t.classList.contains(a)){var l=t.value,c=!1;"radio"===i||"checkbox"===i?c=t.checked:(s[t.tagName.toLowerCase()]||s[i])&&(l=p({maskInputOptions:s,tagName:t.tagName,type:i,value:l,maskInputFn:u}));var d=S(t),v=d.selector,m=d.n;h(t,Te({text:l,isChecked:c,userTriggered:r,selector:v,n:m},f));var y=t.name;"radio"===i&&y&&c&&n.querySelectorAll('input[type="radio"][name="'.concat(y,'"]')).forEach((function(e){if(e!==t){var n=S(e),r=n.selector,o=n.n;h(e,Te({text:e.value,isChecked:!c,userTriggered:!1,selector:r,n:o},f))}}))}}}function h(e,n){var o=_e.get(e);if(!o||o.text!==n.text||o.isChecked!==n.isChecked){_e.set(e,n);var a=r.getId(e);t(i(i({},n),{id:a}))}}var m=("last"===l.input?["change"]:["input","change"]).map((function(e){return Y(e,v,n)})),y=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),g=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"],[HTMLOptionElement.prototype,"selected"]];return y&&y.set&&m.push.apply(m,d([],c(g.map((function(e){return Z(e[0],e[1],{set:function(){v({target:this})}})}))),!1)),function(){m.forEach((function(e){return e()}))}}(e),m=function(e){var t=e.mediaInteractionCb,n=e.blockClass,r=e.mirror,o=e.sampling,a=function(e){return $((function(o){var a=xe(o);if(a&&!ne(a,n)){var i=a,s=i.currentTime,u=i.volume,l=i.muted;t({type:e,id:r.getId(a),currentTime:s,volume:u,muted:l})}}),o.media||500)},i=[Y("play",a(0)),Y("pause",a(1)),Y("seeked",a(2)),Y("volumechange",a(3))];return function(){i.forEach((function(e){return e()}))}}(e),y=function(e,t){var n=e.styleSheetRuleCb,r=e.mirror,o=t.win,a=o.CSSStyleSheet.prototype.insertRule;o.CSSStyleSheet.prototype.insertRule=function(e,t){var o=r.getId(this.ownerNode);return-1!==o&&n({id:o,adds:[{rule:e,index:t}]}),a.apply(this,arguments)};var i=o.CSSStyleSheet.prototype.deleteRule;o.CSSStyleSheet.prototype.deleteRule=function(e){var t=r.getId(this.ownerNode);return-1!==t&&n({id:t,removes:[{index:e}]}),i.apply(this,arguments)};var s={};be?s.CSSGroupingRule=o.CSSGroupingRule:(we&&(s.CSSMediaRule=o.CSSMediaRule),ke&&(s.CSSConditionRule=o.CSSConditionRule),Se&&(s.CSSSupportsRule=o.CSSSupportsRule));var u={};return Object.entries(s).forEach((function(e){var t=c(e,2),o=t[0],a=t[1];u[o]={insertRule:a.prototype.insertRule,deleteRule:a.prototype.deleteRule},a.prototype.insertRule=function(e,t){var a,i=r.getId(null===(a=null==this?void 0:this.parentStyleSheet)||void 0===a?void 0:a.ownerNode);return-1!==i&&n({id:i,adds:[{rule:e,index:d(d([],c(Ne(this)),!1),[t||0],!1)}]}),u[o].insertRule.apply(this,arguments)},a.prototype.deleteRule=function(e){var t,a=r.getId(null===(t=null==this?void 0:this.parentStyleSheet)||void 0===t?void 0:t.ownerNode);return-1!==a&&n({id:a,removes:[{index:d(d([],c(Ne(this)),!1),[e],!1)}]}),u[o].deleteRule.apply(this,arguments)}})),function(){o.CSSStyleSheet.prototype.insertRule=a,o.CSSStyleSheet.prototype.deleteRule=i,Object.entries(s).forEach((function(e){var t=c(e,2),n=t[0],r=t[1];r.prototype.insertRule=u[n].insertRule,r.prototype.deleteRule=u[n].deleteRule}))}}(e,{win:o}),g=function(e,t){var n=e.styleDeclarationCb,r=e.mirror,o=t.win,a=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=function(e,t,o){var i,s,u=r.getId(null===(s=null===(i=this.parentRule)||void 0===i?void 0:i.parentStyleSheet)||void 0===s?void 0:s.ownerNode);return-1!==u&&n({id:u,set:{property:e,value:t,priority:o},index:Ne(this.parentRule)}),a.apply(this,arguments)};var i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=function(e){var t,o,a=r.getId(null===(o=null===(t=this.parentRule)||void 0===t?void 0:t.parentStyleSheet)||void 0===o?void 0:o.ownerNode);return-1!==a&&n({id:a,remove:{property:e},index:Ne(this.parentRule)}),i.apply(this,arguments)},function(){o.CSSStyleDeclaration.prototype.setProperty=a,o.CSSStyleDeclaration.prototype.removeProperty=i}}(e,{win:o}),b=e.collectFonts?function(e){var t=e.fontCb,n=e.doc,r=n.defaultView;if(!r)return function(){};var o=[],a=new WeakMap,i=r.FontFace;r.FontFace=function(e,t,n){var r=new i(e,t,n);return a.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};var s=Q(n.fonts,"add",(function(e){return function(n){return setTimeout((function(){var e=a.get(n);e&&(t(e),a.delete(n))}),0),e.apply(this,[n])}}));return o.push((function(){r.FontFace=i})),o.push(s),function(){o.forEach((function(e){return e()}))}}(e):function(){},w=[];try{for(var k=l(e.plugins),x=k.next();!x.done;x=k.next()){var C=x.value;w.push(C.observer(C.callback,o,C.options))}}catch(e){n={error:e}}finally{try{x&&!x.done&&(r=k.return)&&r.call(k)}finally{if(n)throw n.error}}return function(){ge.forEach((function(e){return e.reset()})),a.disconnect(),s(),u(),f(),v(),h(),m(),y(),g(),b(),w.forEach((function(e){return e()}))}}var Re=function(){function e(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}return e.prototype.addIframe=function(e){this.iframes.set(e,!0)},e.prototype.addLoadListener=function(e){this.loadListener=e},e.prototype.attachIframe=function(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,e)},e}(),De=function(){function e(e){this.restorePatches=[],this.mutationCb=e.mutationCb,this.wxInputCb=e.wxInputCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;var t=this;this.restorePatches.push(Q(HTMLElement.prototype,"attachShadow",(function(e){return function(){var n=e.apply(this,arguments);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,this.ownerDocument),n}})))}return e.prototype.addShadowRoot=function(e,t){Ce(i(i({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,wxInputCb:this.wxInputCb,mirror:this.mirror,shadowDomManager:this}),e),Ie(i(i({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror}))},e.prototype.observeAttachShadow=function(e){if(e.contentWindow){var t=this;this.restorePatches.push(Q(e.contentWindow.HTMLElement.prototype,"attachShadow",(function(n){return function(){var r=n.apply(this,arguments);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,e.contentDocument),r}})))}},e.prototype.reset=function(){this.restorePatches.forEach((function(e){return e()}))},e}();for(var Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ae=0;Ae<Le.length;Ae++)Fe[Le.charCodeAt(Ae)]=Ae;var We=new Map;var Pe=function(e,t,n){if(e&&(Ue(e,t)||"object"==typeof e)){var r=function(e,t){var n=We.get(e);return n||(n=new Map,We.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}(n,e.constructor.name),o=r.indexOf(e);return-1===o&&(o=r.length,r.push(e)),o}};function je(e,t,n){if(e instanceof Array)return e.map((function(e){return je(e,t,n)}));if(null===e)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray)return{rr_type:e.constructor.name,args:[Object.values(e)]};if(e instanceof ArrayBuffer){var r=e.constructor.name,o=function(e){var t,n=new Uint8Array(e),r=n.length,o="";for(t=0;t<r;t+=3)o+=Le[n[t]>>2],o+=Le[(3&n[t])<<4|n[t+1]>>4],o+=Le[(15&n[t+1])<<2|n[t+2]>>6],o+=Le[63&n[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o}(e);return{rr_type:r,base64:o}}return e instanceof DataView?{rr_type:e.constructor.name,args:[je(e.buffer,t,n),e.byteOffset,e.byteLength]}:e instanceof HTMLImageElement?{rr_type:e.constructor.name,src:e.src}:e instanceof ImageData?{rr_type:e.constructor.name,args:[je(e.data,t,n),e.width,e.height]}:Ue(e,t)||"object"==typeof e?{rr_type:e.constructor.name,index:Pe(e,t,n)}:e}var He=function(e,t,n){return d([],c(e),!1).map((function(e){return je(e,t,n)}))},Ue=function(e,t){var n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((function(e){return"function"==typeof t[e]}));return Boolean(n.find((function(n){return e instanceof t[n]})))};function ze(e,t,n,r,o,a){var i,s,u=[],f=Object.getOwnPropertyNames(e),p=function(i){try{if("function"!=typeof e[i])return"continue";var s=Q(e,i,(function(s){return function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];var f=s.apply(this,u);if(Pe(f,a,e),!ne(this.canvas,r)){o.getId(this.canvas);var p=He(d([],c(u),!1),a,e),v={type:t,property:i,args:p};n(this.canvas,v)}return f}}));u.push(s)}catch(r){var l=Z(e,i,{set:function(e){n(this.canvas,{type:t,property:i,args:[e],setter:!0})}});u.push(l)}};try{for(var v=l(f),h=v.next();!h.done;h=v.next()){p(h.value)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(s=v.return)&&s.call(v)}finally{if(i)throw i.error}}return u}var Be,Ve,Ge=function(){function e(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=function(e,t){!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)},this.mutationCb=e.mutationCb,this.mirror=e.mirror,!0===e.recordCanvas&&this.initCanvasMutationObserver(e.win,e.blockClass)}return e.prototype.reset=function(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()},e.prototype.freeze=function(){this.frozen=!0},e.prototype.unfreeze=function(){this.frozen=!1},e.prototype.lock=function(){this.locked=!0},e.prototype.unlock=function(){this.locked=!1},e.prototype.initCanvasMutationObserver=function(e,t){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();var n=function(e,t){var n=[];try{var o=Q(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(n){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return ne(this,t)||"__context"in this||(this.__context=n),e.apply(this,d([n],c(r),!1))}}));n.push(o)}catch(e){r.error("failed to patch HTMLCanvasElement.prototype.getContext")}return function(){n.forEach((function(e){return e()}))}}(e,t),o=function(e,t,n,r){var o,a,i=[],s=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype),u=function(r){try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[r])return"continue";var o=Q(t.CanvasRenderingContext2D.prototype,r,(function(t){return function(){for(var o=this,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];return ne(this.canvas,n)||setTimeout((function(){var t=d([],c(a),!1);if("drawImage"===r&&t[0]&&t[0]instanceof HTMLCanvasElement){var n=t[0],i=n.getContext("2d"),s=null==i?void 0:i.getImageData(0,0,n.width,n.height),u=null==s?void 0:s.data;t[0]=JSON.stringify(u)}e(o.canvas,{type:U["2D"],property:r,args:t})}),0),t.apply(this,a)}}));i.push(o)}catch(n){var a=Z(t.CanvasRenderingContext2D.prototype,r,{set:function(t){e(this.canvas,{type:U["2D"],property:r,args:[t],setter:!0})}});i.push(a)}};try{for(var f=l(s),p=f.next();!p.done;p=f.next())u(p.value)}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}return function(){i.forEach((function(e){return e()}))}}(this.processMutation.bind(this),e,t,this.mirror),a=function(e,t,n,r){var o=[];return o.push.apply(o,d([],c(ze(t.WebGLRenderingContext.prototype,U.WebGL,e,n,r,t)),!1)),void 0!==t.WebGL2RenderingContext&&o.push.apply(o,d([],c(ze(t.WebGL2RenderingContext.prototype,U.WebGL2,e,n,r,t)),!1)),function(){o.forEach((function(e){return e()}))}}(this.processMutation.bind(this),e,t,this.mirror);this.resetObservers=function(){n(),o(),a()}},e.prototype.startPendingCanvasMutationFlusher=function(){var e=this;requestAnimationFrame((function(){return e.flushPendingCanvasMutations()}))},e.prototype.startRAFTimestamping=function(){var e=this,t=function(n){e.rafStamps.latestId=n,requestAnimationFrame(t)};requestAnimationFrame(t)},e.prototype.flushPendingCanvasMutations=function(){var e=this;this.pendingCanvasMutations.forEach((function(t,n){var r=e.mirror.getId(n);e.flushPendingCanvasMutationFor(n,r)})),requestAnimationFrame((function(){return e.flushPendingCanvasMutations()}))},e.prototype.flushPendingCanvasMutationFor=function(e,t){if(!this.frozen&&!this.locked){var n=this.pendingCanvasMutations.get(e);if(n&&-1!==t){var r=n.map((function(e){e.type;var t=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["type"]);return t})),o=n[0].type;this.mutationCb({id:t,type:o,commands:r}),this.pendingCanvasMutations.delete(e)}}},e}();function qe(e){return i(i({},e),{timestamp:Date.now()})}var Xe={map:{},getId:function(e){return e&&e.__sn?e.__sn.id:-1},getNode:function(e){return this.map[e]||null},removeNodeFromMap:function(e){var t=this,n=e.__sn&&e.__sn.id;delete this.map[n],e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},has:function(e){return this.map.hasOwnProperty(e)},reset:function(){this.map={}}};function Ye(e){void 0===e&&(e={});var t=e.emit,n=e.checkoutEveryNms,o=e.checkoutEveryNth,a=e.blockClass,s=void 0===a?"rr-block":a,u=e.blockSelector,d=void 0===u?null:u,f=e.ignoreClass,p=void 0===f?"rr-ignore":f,v=e.inlineStylesheet,h=void 0===v||v,m=e.maskAllInputs,y=e.maskInputOptions,g=e.slimDOMOptions,b=e.maskInputFn,w=e.maskTextFn,S=e.hooks,k=e.sampling,x=void 0===k?{}:k,C=e.mousemoveWait,M=e.recordCanvas,I=void 0!==M&&M,T=e.userTriggeredOnInput,E=void 0!==T&&T,_=e.collectFonts,N=void 0!==_&&_,O=e.inlineImages,R=void 0!==O&&O,D=e.unmaskClass,L=void 0===D?"wxobs-unmask":D,F=e.maskClass,A=void 0===F?"wxobs-mask":F,j=e.isWhitelistMaskMode,H=void 0===j||j,U=e.plugins,z=e.keepIframeSrcFn,B=void 0===z?function(){return!1}:z,V=e.hashText,G=void 0!==V&&V,q=e.cachedTextHashes,K=void 0===q?new Set:q,J=e.uncachedTextMap,$=void 0===J?new Map:J,Z=e.enableMask,Q=void 0===Z||Z;if(!t)throw new Error("emit function is required");void 0!==C&&void 0===x.mousemove&&(x.mousemove=C);var ne,re,oe=!0===m?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==y?y:{password:!0},ae=!0===g||"all"===g?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===g,headMetaDescKeywords:"all"===g}:g||{};void 0===ne&&(ne=window),"NodeList"in ne&&!ne.NodeList.prototype.forEach&&(ne.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in ne&&!ne.DOMTokenList.prototype.forEach&&(ne.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1});var ue=0;Be=function(e,r){var a;if(!(null===(a=ge[0])||void 0===a?void 0:a.isFrozen())||e.type===W.FullSnapshot||e.type===W.IncrementalSnapshot&&e.data.source===P.Mutation||ge.forEach((function(e){return e.unfreeze()})),t(function(e){var t,n;try{for(var r=l(U||[]),o=r.next();!o.done;o=r.next()){var a=o.value;a.eventProcessor&&(e=a.eventProcessor(e))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return e}(e),r),e.type===W.FullSnapshot)re=e,ue=0;else if(e.type===W.IncrementalSnapshot){if(e.data.source===P.Mutation&&e.data.isAttachIframe)return;ue++;var i=o&&ue>=o,s=n&&e.timestamp-re.timestamp>n;(i||s)&&Ve(!0)}};var le=function(e){Be(qe({type:W.IncrementalSnapshot,data:i({source:P.Mutation},e)}))},ce=function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.WxInput},e)}))},de=function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.Scroll},e)}))},fe=function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.CanvasMutation},e)}))},pe=new Re({mutationCb:le}),ve=new Ge({recordCanvas:I,mutationCb:fe,win:window,blockClass:s,mirror:Xe}),he=new De({mutationCb:le,scrollCb:de,wxInputCb:ce,bypassOptions:{blockClass:s,blockSelector:d,inlineStylesheet:h,maskInputOptions:oe,maskTextFn:w,maskInputFn:b,recordCanvas:I,inlineImages:R,sampling:x,slimDOMOptions:ae,iframeManager:pe,canvasManager:ve,unmaskClass:L,maskClass:A,isWhitelistMaskMode:H},mirror:Xe});Ve=function(e){var t,n,o,a;void 0===e&&(e=!1),Be(qe({type:W.Meta,data:{href:window.location.href,width:te(),height:ee()}}),e),ge.forEach((function(e){return e.lock()}));var i=c(function(e,t){var n=t||{},r=n.blockClass,o=void 0===r?"rr-block":r,a=n.blockSelector,i=void 0===a?null:a,s=n.inlineStylesheet,u=void 0===s||s,l=n.inlineImages,c=void 0!==l&&l,d=n.recordCanvas,f=void 0!==d&&d,p=n.maskAllInputs,v=void 0!==p&&p,h=n.maskTextFn,m=n.maskInputFn,y=n.slimDOM,g=void 0!==y&&y,b=n.dataURLOptions,w=n.preserveWhiteSpace,S=n.onSerialize,k=n.onIframeLoad,x=n.iframeLoadTimeout,C=n.keepIframeSrcFn,M=void 0===C?function(){return!1}:C,I=n.unmaskClass,T=void 0===I?"wxobs-unmask":I,E=n.maskClass,_=void 0===E?"wxobs-mask":E,N=n.isWhitelistMaskMode,O=void 0===N||N,R=n.hashText,D=n.cachedTextHashes,L=n.uncachedTextMap,F=n.enableMask,A={};return[X(e,{doc:e,map:A,blockClass:o,blockSelector:i,skipChild:!1,inlineStylesheet:u,maskInputOptions:!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===v?{password:!0}:v,maskTextFn:h,maskInputFn:m,slimDOMOptions:!0===g||"all"===g?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===g,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===g?{}:g,dataURLOptions:b,inlineImages:c,recordCanvas:f,preserveWhiteSpace:w,onSerialize:S,onIframeLoad:k,iframeLoadTimeout:x,keepIframeSrcFn:M,unmaskClass:T,maskClass:_,isWhitelistMaskMode:O,hashText:R,cachedTextHashes:D,uncachedTextMap:L,enableMask:void 0===F||F}),A]}(document,{blockClass:s,blockSelector:d,inlineStylesheet:h,maskAllInputs:oe,maskTextFn:w,slimDOM:ae,recordCanvas:I,inlineImages:R,enableMask:Q,onSerialize:function(e){ie(e)&&pe.addIframe(e),se(e)&&he.addShadowRoot(e.shadowRoot,document),ye(e,ce)},onIframeLoad:function(e,t){},keepIframeSrcFn:B,unmaskClass:L,maskClass:A,isWhitelistMaskMode:H,hashText:G,cachedTextHashes:K,uncachedTextMap:$}),2),u=i[0],l=i[1];if(!u)return r.warn("Failed to snapshot the document");Xe.map=l,Be(qe({type:W.FullSnapshot,data:{node:u,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===document||void 0===document?void 0:document.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(a=null===(o=null===document||void 0===document?void 0:document.body)||void 0===o?void 0:o.parentElement)||void 0===a?void 0:a.scrollTop)||(null===document||void 0===document?void 0:document.body.scrollTop)||0}}})),ge.forEach((function(e){return e.unlock()}))};try{var me=[];me.push(Y("DOMContentLoaded",(function(){Be(qe({type:W.DomContentLoaded,data:{}}))})));var be=function(e){var t;return Oe({mutationCb:le,wxInputCb:ce,mousemoveCb:function(e,t){return Be(qe({type:W.IncrementalSnapshot,data:{source:t,positions:e}}))},mouseInteractionCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.MouseInteraction},e)}))},scrollCb:de,viewportResizeCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.ViewportResize},e)}))},inputCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.Input},e)}))},mediaInteractionCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.MediaInteraction},e)}))},styleSheetRuleCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.StyleSheetRule},e)}))},styleDeclarationCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.StyleDeclaration},e)}))},canvasMutationCb:fe,fontCb:function(e){return Be(qe({type:W.IncrementalSnapshot,data:i({source:P.Font},e)}))},blockClass:s,ignoreClass:p,maskInputOptions:oe,inlineStylesheet:h,sampling:x,recordCanvas:I,inlineImages:R,userTriggeredOnInput:E,collectFonts:N,doc:e,maskInputFn:b,maskTextFn:w,blockSelector:d,slimDOMOptions:ae,mirror:Xe,iframeManager:pe,shadowDomManager:he,canvasManager:ve,unmaskClass:L,maskClass:A,isWhitelistMaskMode:H,hashText:G,cachedTextHashes:K,uncachedTextMap:$,enableMask:Q,plugins:(null===(t=null==U?void 0:U.filter((function(e){return e.observer})))||void 0===t?void 0:t.map((function(e){return{observer:e.observer,options:e.options,callback:function(t){return Be(qe({type:W.Plugin,data:{plugin:e.name,payload:t}}))}}})))||[]},S)};pe.addLoadListener((function(e){me.push(be(e.contentDocument))}));var we=function(){Ve(),me.push(be(document))};return"interactive"===document.readyState||"complete"===document.readyState?we():me.push(Y("load",(function(){Be(qe({type:W.Load,data:{}})),we()}),window)),function(){me.forEach((function(e){return e()}))}}catch(e){r.warn(e)}}Ye.addCustomEvent=function(e,t){if(!Be)throw new Error("please add custom event after start recording");Be(qe({type:W.Custom,data:{tag:e,payload:t}}))},Ye.freezePage=function(){ge.forEach((function(e){return e.freeze()}))},Ye.takeFullSnapshot=function(e){if(!Ve)throw new Error("please take full snapshot after start recording");Ve(e)},Ye.mirror=Xe;var Ke="WXOBS",Je="EVENT",$e=function(e,t,n){var r=this;this.db=null,this.pendingEvents=[],this.sessionUuid=null,this.webviewId=null,this.path=null,this.saveEvent=function(e){if(null===r.db)r.pendingEvents.push(e);else{var t={event:e,index:"".concat(r.sessionUuid,"_").concat(r.webviewId),webviewId:r.webviewId,sessionUuid:r.sessionUuid,path:r.path};r.db.transaction([Je],"readwrite").objectStore(Je).add(t).onerror=function(e){}}},this.saveEvents=function(e){var t,n;if(null===r.db)r.pendingEvents=d(d([],c(r.pendingEvents),!1),c(e),!1);else{var o=r.db.transaction([Je],"readwrite").objectStore(Je);try{for(var a=l(e),i=a.next();!i.done;i=a.next()){var s={event:i.value,index:Ze(r.sessionUuid,r.webviewId),webviewId:r.webviewId,sessionUuid:r.sessionUuid,path:r.path};o.add(s).onerror=function(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},this.getEventsByWebviewId=function(e){return s(r,void 0,void 0,(function(){var t=this;return u(this,(function(n){switch(n.label){case 0:return[4,this.dbInited()];case 1:return n.sent(),[2,new Promise((function(n){var r,o=null===(r=t.db)||void 0===r?void 0:r.transaction([Je]),a=null==o?void 0:o.objectStore(Je),i=null==a?void 0:a.index("uuid-webviewId"),s=IDBKeyRange.only(Ze(t.sessionUuid,e)),u=null==i?void 0:i.getAll(s);u&&(u.onsuccess=function(){n(u.result)})}))]}}))}))},this.getAllEvents=function(){return s(r,void 0,void 0,(function(){var e=this;return u(this,(function(t){switch(t.label){case 0:return[4,this.dbInited()];case 1:return t.sent(),[2,new Promise((function(t){var n,r=null===(n=e.db)||void 0===n?void 0:n.transaction([Je]),o=null==r?void 0:r.objectStore(Je),a=null==o?void 0:o.getAll();a&&(a.onsuccess=function(){t(a.result)})}))]}}))}))},this.getEvents=function(){return s(r,void 0,void 0,(function(){return u(this,(function(e){return[2,this.getEventsByWebviewId(this.webviewId)]}))}))},this.clearEventsByWebviewId=function(e){return s(r,void 0,void 0,(function(){var t,n,r,o,a,i;return u(this,(function(s){switch(s.label){case 0:return[4,this.dbInited()];case 1:return s.sent(),t=null===(i=this.db)||void 0===i?void 0:i.transaction([Je],"readwrite"),n=null==t?void 0:t.objectStore(Je),r=null==n?void 0:n.index("uuid-webviewId"),o=IDBKeyRange.only(Ze(this.sessionUuid,e)),(a=null==r?void 0:r.getAllKeys(o))&&(a.onsuccess=function(){var e,t,r;try{for(var o=l(null==a?void 0:a.result),i=o.next();!i.done;i=o.next()){var s=i.value;null==n||n.delete(s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}"[wxobs]clear ".concat(null===(r=null==a?void 0:a.result)||void 0===r?void 0:r.length," event in indexedDB")}),[2]}}))}))},this.clearEvents=function(){return s(r,void 0,void 0,(function(){return u(this,(function(e){return this.clearEventsByWebviewId(this.webviewId),[2]}))}))},this.dbInited=function(){return new Promise((function(e){var t=null,n=function(){r.db&&(clearInterval(t),e(!0))};t=setInterval(n,100),n()}))},this.cleanGarbageEvents=function(){return s(r,void 0,void 0,(function(){var e,t,n,r,o;return u(this,(function(a){switch(a.label){case 0:return[4,this.dbInited()];case 1:return a.sent(),e=null===(o=this.db)||void 0===o?void 0:o.transaction([Je],"readwrite"),t=null==e?void 0:e.objectStore(Je),(n=null==t?void 0:t.openCursor())&&(r=(new Date).getTime(),n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;r-n.event.timestamp>3e4&&t.delete(),t.continue()}}),[2]}}))}))},this.sessionUuid=e,this.webviewId=t,this.path=n;var o=indexedDB.open(Ke);o.onsuccess=function(e){r.db=o.result,"[wxobs]".concat(Ke," is opened"),r.saveEvents(r.pendingEvents),r.pendingEvents=[],r.cleanGarbageEvents()},o.onupgradeneeded=function(e){var t=o.result;t.objectStoreNames.contains(Je)||t.createObjectStore(Je,{autoIncrement:!0}).createIndex("uuid-webviewId","index",{unique:!1}),e.target.transaction.oncomplete=function(){"[wxobs]".concat(Je," table created")}},o.onerror=function(e){"[wxobs]open ".concat(Ke," database failed: ")}};function Ze(e,t){return"".concat(e,"_").concat(t)}var Qe=1,et=new Map;var tt=[],nt=function(e){};!function(){try{var e=new MessageChannel,t=e.port1,n=e.port2;t.onmessage=function(){if(tt.length>0){var e=tt.shift();e&&e()}},nt=function(e){tt.push(e),n.postMessage(null)}}catch(e){}}();var rt=Uint8Array,ot=Uint16Array,at=Uint32Array,it=new rt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),st=new rt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ut=new rt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lt=function(e,t){for(var n=new ot(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new at(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)o[a]=a-n[r]<<5|r;return[n,o]},ct=c(lt(it,2),2),dt=ct[0],ft=ct[1];dt[28]=258,ft[258]=28;var pt=c(lt(st,0),2);pt[0];for(var vt=pt[1],ht=new ot(32768),mt=0;mt<32768;++mt){var yt=(43690&mt)>>>1|(21845&mt)<<1;yt=(61680&(yt=(52428&yt)>>>2|(13107&yt)<<2))>>>4|(3855&yt)<<4,ht[mt]=((65280&yt)>>>8|(255&yt)<<8)>>>1}var gt=function(e,t,n){for(var r=e.length,o=0,a=new ot(t);o<r;++o)e[o]&&++a[e[o]-1];var i,s=new ot(t);for(o=0;o<t;++o)s[o]=s[o-1]+a[o-1]<<1;if(n){i=new ot(1<<t);var u=15-t;for(o=0;o<r;++o)if(e[o])for(var l=o<<4|e[o],c=t-e[o],d=s[e[o]-1]++<<c,f=d|(1<<c)-1;d<=f;++d)i[ht[d]>>>u]=l}else for(i=new ot(r),o=0;o<r;++o)e[o]&&(i[o]=ht[s[e[o]-1]++]>>>15-e[o]);return i},bt=new rt(288);for(mt=0;mt<144;++mt)bt[mt]=8;for(mt=144;mt<256;++mt)bt[mt]=9;for(mt=256;mt<280;++mt)bt[mt]=7;for(mt=280;mt<288;++mt)bt[mt]=8;var wt=new rt(32);for(mt=0;mt<32;++mt)wt[mt]=5;var St=gt(bt,9,0);gt(bt,9,1);var kt=gt(wt,5,0);gt(wt,5,1);var xt=function(e){return(e+7)/8|0},Ct=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?ot:4==e.BYTES_PER_ELEMENT?at:rt)(n-t);return r.set(e.subarray(t,n)),r},Mt=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},It=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},Tt=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,a=n.slice();if(!o)return[Lt,0];if(1==o){var i=new rt(n[0].s+1);return i[n[0].s]=1,[i,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],u=n[1],l=0,c=1,d=2;for(n[0]={s:-1,f:s.f+u.f,l:s,r:u};c!=o-1;)s=n[n[l].f<n[d].f?l++:d++],u=n[l!=c&&n[l].f<n[d].f?l++:d++],n[c++]={s:-1,f:s.f+u.f,l:s,r:u};var f=a[0].s;for(r=1;r<o;++r)a[r].s>f&&(f=a[r].s);var p=new ot(f+1),v=Et(n[c-1],p,0);if(v>t){r=0;var h=0,m=v-t,y=1<<m;for(a.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));r<o;++r){var g=a[r].s;if(!(p[g]>t))break;h+=y-(1<<v-p[g]),p[g]=t}for(h>>>=m;h>0;){var b=a[r].s;p[b]<t?h-=1<<t-p[b]++-1:++r}for(;r>=0&&h;--r){var w=a[r].s;p[w]==t&&(--p[w],++h)}v=t}return[new rt(p),v]},Et=function(e,t,n){return-1==e.s?Math.max(Et(e.l,t,n+1),Et(e.r,t,n+1)):t[e.s]=n},_t=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new ot(++t),r=0,o=e[0],a=1,i=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==o&&s!=t)++a;else{if(!o&&a>2){for(;a>138;a-=138)i(32754);a>2&&(i(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(i(o),--a;a>6;a-=6)i(8304);a>2&&(i(a-3<<5|8208),a=0)}for(;a--;)i(o);a=1,o=e[s]}return[n.subarray(0,r),t]},Nt=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Ot=function(e,t,n){var r=n.length,o=xt(t+2);e[o]=255&r,e[o+1]=r>>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var a=0;a<r;++a)e[o+a+4]=n[a];return 8*(o+4+r)},Rt=function(e,t,n,r,o,a,i,s,u,l,d){Mt(t,d++,n),++o[256];for(var f=c(Tt(o,15),2),p=f[0],v=f[1],h=c(Tt(a,15),2),m=h[0],y=h[1],g=c(_t(p),2),b=g[0],w=g[1],S=c(_t(m),2),k=S[0],x=S[1],C=new ot(19),M=0;M<b.length;++M)C[31&b[M]]++;for(M=0;M<k.length;++M)C[31&k[M]]++;for(var I=c(Tt(C,7),2),T=I[0],E=I[1],_=19;_>4&&!T[ut[_-1]];--_);var N,O,R,D,L=l+5<<3,F=Nt(o,bt)+Nt(a,wt)+i,A=Nt(o,p)+Nt(a,m)+i+14+3*_+Nt(C,T)+(2*C[16]+3*C[17]+7*C[18]);if(L<=F&&L<=A)return Ot(t,d,e.subarray(u,u+l));if(Mt(t,d,1+(A<F)),d+=2,A<F){N=gt(p,v,0),O=p,R=gt(m,y,0),D=m;var W=gt(T,E,0);Mt(t,d,w-257),Mt(t,d+5,x-1),Mt(t,d+10,_-4),d+=14;for(M=0;M<_;++M)Mt(t,d+3*M,T[ut[M]]);d+=3*_;for(var P=[b,k],j=0;j<2;++j){var H=P[j];for(M=0;M<H.length;++M){var U=31&H[M];Mt(t,d,W[U]),d+=T[U],U>15&&(Mt(t,d,H[M]>>>5&127),d+=H[M]>>>12)}}}else N=St,O=bt,R=kt,D=wt;for(M=0;M<s;++M)if(r[M]>255){U=r[M]>>>18&31;It(t,d,N[U+257]),d+=O[U+257],U>7&&(Mt(t,d,r[M]>>>23&31),d+=it[U]);var z=31&r[M];It(t,d,R[z]),d+=D[z],z>3&&(It(t,d,r[M]>>>5&8191),d+=st[z])}else It(t,d,N[r[M]]),d+=O[r[M]];return It(t,d,N[256]),d+O[256]},Dt=new at([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Lt=new rt(0),Ft=function(e,t,n,r,o,a){return s(void 0,void 0,void 0,(function(){var i,s,l,c,d,f,p,v,h,m,y,g,b,w,S,k,x,C,M,I,T,E,_,N,O,R,D,L;return u(this,(function(u){switch(u.label){case 0:if(i=e.length,s=new rt(r+i+5*(1+Math.ceil(i/7e3))+o),l=s.subarray(r,s.length-o),c=0,t&&!(i<8))return[3,1];for(d=0;d<=i;d+=65535)(f=d+65535)>=i&&(l[c>>3]=a),c=Ot(l,c+1,e.subarray(d,f));return[3,3];case 1:return p=Dt[t-1],v=p>>>13,h=8191&p,m=(1<<n)-1,y=new ot(32768),g=new ot(m+1),b=Math.ceil(n/3),w=2*b,S=function(t){return(e[t]^e[t+1]<<b^e[t+2]<<w)&m},k=new at(25e3),x=new ot(288),C=new ot(32),M=0,I=0,T=0,E=0,_=0,N=0,O=1,1e4,D=new Promise((function(e){R=e})),L=function(){for(var t=(new Date).getTime(),n=!1;T<i&&!n;){for(;T<i&&T<1e4*O;++T){var r=S(T),o=32767&T,a=g[r];if(y[o]=a,g[r]=o,_<=T){var s=i-T;if((M>7e3||E>24576)&&s>423){c=Rt(e,l,0,k,x,C,I,E,N,T-N,c),E=M=I=0,N=T;for(var u=0;u<286;++u)x[u]=0;for(u=0;u<30;++u)C[u]=0}var d=2,f=0,p=h,m=o-a&32767;if(s>2&&r==S(T-m))for(var b=Math.min(v,s)-1,w=Math.min(32767,T),D=Math.min(258,s);m<=w&&--p&&o!=a;){if(e[T+d]==e[T+d-m]){for(var F=0;F<D&&e[T+F]==e[T+F-m];++F);if(F>d){if(d=F,f=m,F>b)break;var A=Math.min(m,F-2),W=0;for(u=0;u<A;++u){var P=T-m+u+32768&32767,j=P-y[P]+32768&32767;j>W&&(W=j,a=P)}}}m+=(o=a)-(a=y[o])+32768&32767}if(f){k[E++]=268435456|ft[d]<<18|vt[f];var H=31&ft[d],U=31&vt[f];I+=it[H]+st[U],++x[257+H],++C[U],_=T+d,++M}else k[E++]=e[T],++x[e[T]]}}++O,n=(new Date).getTime()-t>10}T===i?R():nt(L)},nt(L),[4,D];case 2:u.sent(),c=Rt(e,l,a,k,x,C,I,E,N,T-N,c),!a&&7&c&&(c=Ot(l,c+1,Lt)),u.label=3;case 3:return[2,Ct(s,0,r+xt(c)+o)]}}))}))};!function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&-306674912)^n>>>1;e[t]=n}}();var At=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Wt=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)};function Pt(e,t){return s(this,void 0,void 0,(function(){var n,r;return u(this,(function(o){switch(o.label){case 0:return t||(t={}),n=function(){var e=1,t=0;return{p:function(n){for(var r=e,o=t,a=0|n.length,i=0;i!=a;){for(var s=Math.min(i+2655,a);i<s;++i)o+=r+=n[i];r=(65535&r)+15*(r>>16),o=(65535&o)+15*(o>>16)}e=r,t=o},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}}(),n.p(e),[4,(a=e,i=t,l=2,c=4,s(void 0,void 0,void 0,(function(){return u(this,(function(e){return[2,Ft(a,null==i.level?6:i.level,null==i.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+i.mem,l,c,!d)]}))})))];case 1:return r=o.sent(),[2,(Wt(r,t),At(r,r.length-4,n.d()),r)]}var a,i,l,c,d}))}))}var jt="undefined"!=typeof TextEncoder&&new TextEncoder,Ht="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ht.decode(Lt,{stream:!0}),1}catch(e){}function Ut(e,t){if(t){for(var n=new rt(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(jt)return jt.encode(e);var o=e.length,a=new rt(e.length+(e.length>>1)),i=0,s=function(e){a[i++]=e};for(r=0;r<o;++r){if(i+5>a.length){var u=new rt(i+8+(o-r<<1));u.set(a),a=u}var l=e.charCodeAt(r);l<128||t?s(l):l<2048?(s(192|l>>6),s(128|63&l)):l>55295&&l<57344?(s(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++r))>>18),s(128|l>>12&63),s(128|l>>6&63),s(128|63&l)):(s(224|l>>12),s(128|l>>6&63),s(128|63&l))}return Ct(a,0,i)}function zt(e){var t;return void 0===e&&(e=!0),s(this,void 0,void 0,(function(){var n,r,o,a,i,s,l,f,p,v,h,m;return u(this,(function(u){switch(u.label){case 0:return n=Yt(),e&&qt()?[2]:0===n.events.length?[2]:(""===n.page&&(r=document.body.getAttribute("is"),n.page=r||""),o=n.params,a=o.sdkVersion,i=o.projectId,s=o.uuid,l=o.userFlag,f=o.compress,p=o.url,"[wxobs]upload ".concat(n.events.length," events"),v=d([],c(n.events),!1),h={record:{uuid:s,event:JSON.stringify(v),path:n.page,projectKey:i,sdkVersion:a,uncachedTexts:JSON.stringify(ue(n.uncachedTextMap)),timestamp:(new Date).getTime(),userFlag:l||"",webviewId:window.__webviewId__}},n.events=[],null===(t=n.storage)||void 0===t||t.clearEvents(),n.uncachedTextMap.clear(),m=JSON.stringify(h),f?[4,Pt(Ut(m))]:[3,2]);case 1:m=u.sent(),u.label=2;case 2:return fetch(p,{method:"POST",headers:{"Content-Type":"application/json","x-wx-ob-source":"web","x-wx-ob-env":"webview","x-wx-ob-sdkversion":a||"","x-wx-ob-pack-version":f?"1.0":"0"},body:m}).catch((function(e){var t;(t=n.events).unshift.apply(t,d([],c(v),!1)),n.events.length>2e3&&Gt()})),[2]}}))}))}var Bt={hashText:!0,userFlag:"",compress:!0,isWhitelistMaskMode:!0,url:"https://servicewechat.com/ob/wxob"},Vt={events:[],page:"",active:!0,visible:!0,recording:!1,cachedTextHashes:new Set,uncachedTextMap:new Map,uploadTask:null,saveStorageTask:null,recorderListner:null,storage:null,params:null};function Gt(){var e;Vt.recorderListner&&Vt.recorderListner(),Vt.uploadTask&&clearInterval(Vt.uploadTask),Vt.saveStorageTask&&clearInterval(Vt.saveStorageTask),Vt.uncachedTextMap.clear(),null===(e=Vt.storage)||void 0===e||e.clearEvents(),Vt.events=[],Vt.recording=!1}function qt(){return!Vt.active||!Vt.visible||"hidden"===document.visibilityState}function Xt(e){Vt.recording&&(!function(e){if(e.seq=Qe,++Qe,e.type===W.IncrementalSnapshot&&e.data.source===P.Mutation){var t=e.data,n=t.adds,r=t.attributes,o=t.texts,a=t.removes;if(0!==r.length&&0===n.length&&0===o.length&&0===a.length){var i=h(JSON.stringify(r));et.has(i)?(e.type=W.Ref,e.data={refSeq:et.get(i)}):et.set(i,e.seq)}}}(e),Vt.events.push(e),function(e){var t;!qt()&&Vt.recording&&(null===(t=Vt.storage)||void 0===t||t.saveEvent(e))}(e),Vt.events.length>2e3&&Gt())}setTimeout((function(){exparser.addListenerToElement(document,"appRoute",(function(e){var t=e.detail.webviewId===window.__webviewId__;if(t!==Vt.visible){if(!1===t&&Vt.recording&&zt(!1),""===Vt.page){var n=document.body.getAttribute("is");Vt.page=n||""}"[wxobs] visibility change from ".concat(Vt.visible," to ").concat(t," (").concat(Vt.page,")"),Vt.visible=t}}))}));var Yt=function(){return Vt};e.default=function(e){if(!Vt.recording)if(Vt.recording=!0,Vt.params)Ye.takeFullSnapshot();else{Vt.params=Object.assign(Bt,e);var t=Vt.params,n=t.isWhitelistMaskMode,r=t.hashText;Vt.storage=new $e(Vt.params.uuid,window.__webviewId__,document.body.getAttribute("is")||""),Vt.recorderListner=Ye({emit:function(e){Xt(e)},maskAllInputs:!0,blockClass:"wxobs-exclude",unmaskClass:"wxobs-unmask",maskClass:"wxobs-mask",hashText:r,isWhitelistMaskMode:n,cachedTextHashes:Vt.cachedTextHashes,uncachedTextMap:Vt.uncachedTextMap,sampling:{input:"last"}}),Vt.uploadTask=setInterval(zt,2e3),function(){var e,t=function(e){var t=e.__originalEvent,n=xe(t),r=t.changedTouches[0];if(r){for(var o=n.__sn.id,a=r.clientX,i=r.clientY,s=r.pageX,u=r.pageY,l=n.getBoundingClientRect(),c=l.height,d=l.width,f=l.x,p=l.y,v=[],h=n;h;){var m=h.getAttribute("id");if(v.push({id:m||"",className:h.className,tag:h.tagName}),!h.parentElement)break;h=h.parentElement}var y=S(n),g=y.n,b=y.selector;Xt({timestamp:Date.now(),type:W.IncrementalSnapshot,data:{source:P.MouseInteraction,type:H.Tap,id:o,x:a,y:i,pageX:s,pageY:u,relativeX:(a-f)/d,relativeY:(i-p)/c,idTrusted:t.isTrusted,identifier:r.identifier,selector:b,n:g}})}},n=[];null===(e=document.body.parentElement)||void 0===e||e.childNodes.forEach((function(e){e.__wxElement&&n.push(exparser.addListenerToElement(e.__wxElement,"tap",t,{useCapture:!0}))}))}(),e.onAppEnterBackground((function(){zt(!1),Vt.active=!1})),e.onAppEnterForeground((function(){Vt.active=!0}))}},e.emitEvent=Xt,e.getContext=Yt,e.killRecord=Gt,e.shouldPause=qt,e.stopRecording=function(){Vt.recording=!1},e.uploadEventsFromClosedWebview=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,c,d,f,p,v,h,m,y,g,b;return u(this,(function(u){switch(u.label){case 0:t=Yt(),null===(n=t.storage)&&(n=new $e(e.uuid,window.__webviewId__,document.body.getAttribute("is")||"")),r=e.unloadedWebviewIds,o=e.sdkVersion,a=e.userFlag,i=e.projectId,s=e.compress,c=e.url,u.label=1;case 1:u.trys.push([1,8,9,10]),d=l(r),f=d.next(),u.label=2;case 2:return f.done?[3,7]:(p=f.value,[4,n.getEventsByWebviewId(p)]);case 3:return(null==(v=u.sent())?void 0:v.length)?(h={record:{uuid:v[0].sessionUuid,event:JSON.stringify(v.map((function(e){return e.event}))),path:v[0].path,projectKey:i,sdkVersion:o,uncachedTexts:JSON.stringify([]),timestamp:(new Date).getTime(),userFlag:a||"",webviewId:v[0].webviewId}},"[wxobs]uploading ".concat(v.length," events of closed webview ").concat(v[0].webviewId," ").concat(v[0].path),n.clearEventsByWebviewId(p),m=JSON.stringify(h),s?[4,Pt(Ut(m))]:[3,5]):[3,6];case 4:m=u.sent(),u.label=5;case 5:fetch(c,{method:"POST",headers:{"Content-Type":"application/json","x-wx-ob-source":"web","x-wx-ob-env":"webview","x-wx-ob-sdkversion":o||"","x-wx-ob-pack-version":s?"1.0":"0"},body:m}).catch((function(e){})),u.label=6;case 6:return f=d.next(),[3,2];case 7:return[3,10];case 8:return y=u.sent(),g={error:y},[3,10];case 9:try{f&&!f.done&&(b=d.return)&&b.call(d)}finally{if(g)throw g.error}return[7];case 10:return[2]}}))}))},n.sdk=e,n.android_webview_inject_end=!0}();